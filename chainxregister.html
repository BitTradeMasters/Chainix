<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Chainix ‚Äì Register</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Poppins',sans-serif;
}

body{
min-height:100vh;
display:flex;
justify-content:center;
align-items:flex-start; /* center ki jagah */
background: radial-gradient(circle at top,#1f3b73,#0f2027 60%);
padding:5px;
overflow-y:auto;
}

/* Container */
.register-box{
width:100%;
max-width:420px;
background:rgba(255,255,255,0.08);
backdrop-filter:blur(18px);
border-radius:5px;
overflow:hidden;

border:1px solid rgba(255,255,255,0.15);
color:#fff;
}

/* Header */
.top-header{
padding:22px;
text-align:center;
background:linear-gradient(135deg,#00c6ff,#0072ff);
font-size:22px;
font-weight:700;
}

/* Form Area */
.form-area{
padding:24px;
}

.input-group{
margin-bottom:14px;
position:relative;
}

.input-group input{
width:100%;
padding:14px;
border-radius:5px;
border:none;
outline:none;
background:rgba(255,255,255,0.12);
color:#fff;
font-size:14px;
}

.input-group input::placeholder{
color:rgba(255,255,255,0.75);
}

.eye{
position:absolute;
right:14px;
top:50%;
transform:translateY(-50%);
cursor:pointer;
font-size:14px;
}

/* Register Button */
button{
width:100%;
padding:14px;
border:none;
border-radius:5px;
background:linear-gradient(135deg,#00c6ff,#0072ff);
color:#fff;
font-weight:600;
cursor:pointer;
margin-top:10px;
font-size:15px;
}

button:disabled{
opacity:0.6;
cursor:not-allowed;
}

/* Login Button */
.login-btn{
background:transparent;
border:1px solid #22c55e;
color:#22c55e;
margin-top:10px;
}

/* Footer */
.footer{
margin-top:15px;
text-align:center;
font-size:13px;
opacity:0.7;
}

/* POPUP */
.popup{
position:fixed;
inset:0;
background:rgba(0,0,0,0.6);
display:none;
justify-content:center;
align-items:center;
z-index:9999;
}

.popup-box{
background:#0f172a;
padding:24px;
border-radius:5px;
text-align:center;
max-width:320px;
width:90%;
color:#fff;
}

.popup-box.error { border:2px solid #ff4d4f; }
.popup-box.success { border:2px solid #22c55e; }
.popup-box.info { border:2px solid #3b82f6; }

.popup-box.error h3 { color:#ff4d4f; }
.popup-box.success h3 { color:#22c55e; }
.popup-box.info h3 { color:#3b82f6; }

.register-box{
width:100%;
max-width:420px;
margin:20px 0; /* add this */
background:rgba(255,255,255,0.08);
backdrop-filter:blur(18px);
border-radius:5px;
overflow:hidden;
box-shadow:0 25px 60px rgba(0,0,0,0.5);
border:1px solid rgba(255,255,255,0.15);
color:#fff;
}

/* POPUP ANIMATION */
.popup-box{
animation: popupIn 0.4s ease;
}

/* Entry */
@keyframes popupIn{
0%{transform:translateY(-40px) scale(.9);opacity:0;}
60%{transform:translateY(10px) scale(1.02);}
100%{transform:translateY(0) scale(1);opacity:1;}
}

/* Shake effect */
.popup-box.shake{
animation:shake .4s ease;
}

@keyframes shake{
0%,100%{transform:translateX(0);}
25%{transform:translateX(-6px);}
50%{transform:translateX(6px);}
75%{transform:translateX(-4px);}
}

/* Exit animation */
.popup-box.out{
animation:popupOut .35s ease forwards;
}

@keyframes popupOut{
to{transform:translateY(-40px);opacity:0;}
}
button.loading{
opacity:.8;
pointer-events:none;
}

button.loading::after{
content:"";
width:16px;
height:16px;
border:2px solid #fff;
border-top:2px solid transparent;
border-radius:50%;
display:inline-block;
margin-left:8px;
animation:spin .7s linear infinite;
}

@keyframes spin{
to{transform:rotate(360deg);}
}
.top-header{
padding:22px;
background:linear-gradient(135deg,#00c6ff,#0072ff);
font-size:22px;
font-weight:700;
display:flex;
justify-content:space-between;
align-items:center;
}

.plan-icon-btn{
background:rgba(255,255,255,0.2);
border:none;
color:#fff;
font-size:18px;
padding:6px 10px;
border-radius:6px;
cursor:pointer;
}

.plan-icon-btn:hover{
background:rgba(255,255,255,0.35);
}
<style>
body {
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
</style>
<style>
* {
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
</style>

</style>
</head>

<body>

<div class="register-box">

<div class="top-header">
    <span>Chainix Register</span>

    <button class="plan-icon-btn"
        onclick="window.location.href='chainixplan.html'"
        title="View Plan">
        üìä
    </button>
</div>


<div class="form-area">
<form id="registerForm">

<div class="input-group">
<input type="text" placeholder="Full Name" id="name" required>
</div>

<div class="input-group">
<input type="email" placeholder="Email Address" id="email" required>
</div>

<div class="input-group">
<input type="password" placeholder="Password" id="password" required>
<span class="eye" onclick="togglePass('password')">üëÅ</span>
</div>

<div class="input-group">
<input type="password" placeholder="Confirm Password" id="confirmPassword" required>
<span class="eye" onclick="togglePass('confirmPassword')">üëÅ</span>
</div>

<div class="input-group">
<input type="text" placeholder="Referral Code (Optional)" id="referral">
</div>

<button type="submit" id="registerBtn">
Create Account
</button>

</form>

<button class="login-btn"
onclick="window.location.href='chainixlogin.html'">
Already have account? Login
</button>

<div class="footer">
Secure ‚Ä¢ Fast ‚Ä¢ Chainix Network
</div>

</div>
</div>

<!-- Popup same as before -->
<div id="popup" class="popup">
<div class="popup-box">
<h3 id="popupTitle"></h3>
<p id="popupMessage"></p>
</div>
</div>

<!-- YOUR EXISTING JS & FIREBASE CODE BELOW SAME RAKHO -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function(){
  emailjs.init("xPVuMwLzXZ7CdCa_2");
})();
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { 
  getFirestore, doc, setDoc, getDoc,
  collection, query, where, getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCUA92fON4_zoyy0fr_VIRJi30M9y0ep6k",
  authDomain: "chainix-e190c.firebaseapp.com",
  projectId: "chainix-e190c",
  storageBucket: "chainix-e190c.firebasestorage.app",
  messagingSenderId: "858117995805",
  appId: "1:858117995805:web:cd394dbb9e9228f04575f4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// password toggle
window.togglePass = function(id){
  const input = document.getElementById(id);
  if(!input) return;
  input.type = input.type === "password" ? "text" : "password";
};

function showPopup(title, message, type="info", redirect=false){
  const popup = document.getElementById("popup");
  const box = popup.querySelector(".popup-box");

  box.classList.remove("error","success","info","shake","out");
  box.classList.add(type);

  document.getElementById("popupTitle").innerText = title;
  document.getElementById("popupMessage").innerText = message;

  popup.style.display = "flex";

  setTimeout(()=> box.classList.add("shake"), 200);
  setTimeout(()=> box.classList.add("out"),2000);

  setTimeout(()=>{
    popup.style.display = "none";
    box.classList.remove("out","shake");
    if(redirect){
      window.location.href="chainixlogin.html";
    }
  },2300);
}

function generateReferralCode(){
  return "CHX" + Math.random().toString(36).substring(2,8).toUpperCase();
}

const form = document.getElementById("registerForm");
const btn = document.getElementById("registerBtn");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  if(btn.classList.contains("loading")) return;
  btn.classList.add("loading");
  btn.disabled = true;

  try {

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const pass = document.getElementById("password").value;
    const confirm = document.getElementById("confirmPassword").value;
    const ref = document.getElementById("referral").value.trim().toUpperCase();

    if(pass !== confirm){
      showPopup("Error", "Passwords do not match");
      return;
    }

    if(ref){
      const q = query(
        collection(db, "users"),
        where("referralCode", "==", ref)
      );

      const snap = await getDocs(q);

      if(snap.empty){
        showPopup("Invalid Referral", "Referral code not found");
        return;
      }
    }

    const userCred = await createUserWithEmailAndPassword(auth, email, pass);
    await sendEmailVerification(userCred.user);

    let newCode;
    let exists = true;

    while(exists){
      newCode = generateReferralCode();

      const q = query(
        collection(db, "users"),
        where("referralCode", "==", newCode)
      );

      const snap = await getDocs(q);
      exists = !snap.empty;
    }

    await setDoc(doc(db, "users", userCred.user.uid), {
      uid: userCred.user.uid,
      name,
      email,
      referralCode: newCode,
      referredBy: ref || null,
      createdAt: new Date().toISOString()
    });

    try {
      await emailjs.send(
        "service_ge771va",
        "template_cy695a7",
        {
          user_name: name,
          user_email: email
        },
        "xPVuMwLzXZ7CdCa_2"
      );
    } catch (e) {
      console.log("EmailJS error:", e);
    }

   showPopup("Success", "Account created successfully.", "success", true);


  } catch (err) {

    let message = "Registration failed";

    if (err.code === "auth/email-already-in-use")
      message = "Email already used in another account";
    else if (err.code === "auth/invalid-email")
      message = "Invalid email address";
    else if (err.code === "auth/weak-password")
      message = "Password must be at least 6 characters";
    else if (err.code === "auth/network-request-failed")
      message = "Network error. Check your internet.";

    showPopup("Error", message);

  } finally {
    btn.disabled = false;
    btn.classList.remove("loading");
  }
});

// runtime tests
console.assert(typeof togglePass === "function", "togglePass should exist");
console.assert(typeof showPopup === "function", "showPopup should exist");

</script>
<script>
// Right click disable
document.addEventListener("contextmenu", e => e.preventDefault());

// Copy shortcut disable
document.addEventListener("keydown", function(e) {
    if (
        (e.ctrlKey && e.key === "c") ||
        (e.ctrlKey && e.key === "u") ||
        (e.ctrlKey && e.key === "s") ||
        (e.ctrlKey && e.key === "a")
    ) {
        e.preventDefault();
    }
});
</script>

<script>
// Right click disable
document.addEventListener("contextmenu", e => e.preventDefault());

// Copy, select all, view source, save block
document.addEventListener("keydown", function(e) {
  if (
    (e.ctrlKey && ["c","a","u","s","x"].includes(e.key.toLowerCase()))
  ) {
    e.preventDefault();
  }
});

// Mouse selection block
document.addEventListener("selectstart", e => e.preventDefault());

// Drag selection block
document.addEventListener("mousedown", e => {
  if (e.detail > 1) e.preventDefault();
});
</script>

</body>
</html>
